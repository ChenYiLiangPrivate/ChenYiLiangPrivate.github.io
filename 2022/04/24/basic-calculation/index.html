<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="求余和求模运算、加法、乘法、除法、幂运算、异或运算">
<meta property="og:type" content="article">
<meta property="og:title" content="基本运算">
<meta property="og:url" content="http://example.com/2022/04/24/basic-calculation/index.html">
<meta property="og:site_name" content="缘溪行">
<meta property="og:description" content="求余和求模运算、加法、乘法、除法、幂运算、异或运算">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426104700623.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426104708155.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426105757303.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426110101126.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426111659514.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426111752200.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426112044386.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426112431394.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426112457632.png">
<meta property="og:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426112510102.png">
<meta property="article:published_time" content="2022-04-24T09:20:36.000Z">
<meta property="article:modified_time" content="2022-04-26T13:34:12.211Z">
<meta property="article:author" content="Cyl">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/04/24/basic-calculation/image-20220426104700623.png">

<link rel="canonical" href="http://example.com/2022/04/24/basic-calculation/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>基本运算 | 缘溪行</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">缘溪行</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">27</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/24/basic-calculation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/icon1.jpg">
      <meta itemprop="name" content="Cyl">
      <meta itemprop="description" content="顽童大了别那么笨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘溪行">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          基本运算
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-24 17:20:36" itemprop="dateCreated datePublished" datetime="2022-04-24T17:20:36+08:00">2022-04-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-26 21:34:12" itemprop="dateModified" datetime="2022-04-26T21:34:12+08:00">2022-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/04/24/basic-calculation/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/04/24/basic-calculation/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>求余和求模运算、加法、乘法、除法、幂运算、异或运算</p>
<span id="more"></span>
<h1 id="求余运算和求模运算"><a href="#求余运算和求模运算" class="headerlink" title="求余运算和求模运算"></a>求余运算和求模运算</h1><p>求余运算在计算商值向 0 方向舍弃小数位，求模运算在计算商值向负无穷方向舍弃小数位</p>
<ul>
<li><p>当商是正数的时候，0 方向和负无穷方向自然是一致的。</p>
<p>  3 % 10 = 3，3 mod 10 = 3</p>
</li>
<li><p>当商是负数的时候，</p>
<p>  -3/10 = -0.3</p>
<p>  -3 % 10 = 0…-3，-3 mod 10 = -1…-7</p>
</li>
</ul>
<p>Java 中取余是 %，取模是 Math.floorMod</p>
<p>用 $\odot $ 作为求余运算符，求余运算的性质：</p>
<ul>
<li><p>乘法性质</p>
<script type="math/tex; mode=display">
  (xy)\odot p=[(x\odot p)(y\odot p)]\odot p</script></li>
<li><p>加法性质</p>
</li>
</ul>
<script type="math/tex; mode=display">
(x+y)\odot p=[(x\odot p)+(y\odot p)]\odot p</script><h2 id="大数取余"><a href="#大数取余" class="headerlink" title="大数取余"></a>大数取余</h2><p>大数：x*y（x 和 y 在 int32 内）超出 int32 的取值范围</p>
<p><strong>大数求余问题1</strong>： 在仅使用 int32 类型存储的前提下，正确计算并存储 x*y 对 p 求余的值。<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/jian-sheng-zi-ii-lcof/solution/mian-shi-ti-14-ii-jian-sheng-zi-iitan-xin-er-fen-f/">大数求余</a></p>
<p>基于求余运算乘法性质，存储乘法后求余的结果，而非存储乘法结果。$[(x\odot p)(y\odot p)]$ 可能溢出，该中括号的结果可能需要用 long 以上存储</p>
<p>当 大数为 x 的幂次方时，基于求余运算乘法性质，有两种方法</p>
<ul>
<li>循环求余</li>
<li>快速幂求余</li>
</ul>
<p><strong>大数求余问题2</strong></p>
<p>大数：x+y</p>
<p>基于求余运算加法性质，存储加法后求余的结果，而非存储加法结果</p>
<p>例如，ans = a+b+c+d+…，由于不断累积可能导致溢出，题目要求最终输出 ans % MOD。则每一步存储 a % MOD，b % MOD，…，最终(a % MOD+ b % MOD+…) % MOD = ans % MOD</p>
<p>为了应用此方法，</p>
<ul>
<li><p>$[(x\odot p)+(y\odot p)]$ 可能溢出，该中括号的结果可能需要用 long 以上存储</p>
</li>
<li><p>x += y 需等效为 x=x+y</p>
</li>
</ul>
<h1 id="加法运算"><a href="#加法运算" class="headerlink" title="加法运算"></a>加法运算</h1><h2 id="位运算实现加法运算"><a href="#位运算实现加法运算" class="headerlink" title="位运算实现加法运算"></a>位运算实现加法运算</h2><p>两个一比特数的加法运算的真值表。</p>
<p>输入是两个数，输出是两个数：本位和、进位。</p>
<p><img src="/2022/04/24/basic-calculation/image-20220426104700623.png" alt></p>
<p><img src="/2022/04/24/basic-calculation/image-20220426104708155.png" alt></p>
<p>注意 c 是与运算后左移，左移是为了符合其真实的位置。实际的结果：n + c</p>
<p>对于两个整数，不需要逐个对二进制位进行以上位运算，<strong>可以直接推广到两个整数的加法运算</strong>：</p>
<p>设 a 和 b 是两个整数，a+b 的非进位和 = a^b，a+b 的进位 = a&amp;b&lt;&lt;1</p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/bu-yong-jia-jian-cheng-chu-zuo-jia-fa-lcof/">剑指 Offer 65. 不用加减乘除做加法</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(b != <span class="number">0</span>) &#123; <span class="comment">// 当进位为 0 时跳出</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> (a &amp; b) &lt;&lt; <span class="number">1</span>; <span class="comment">// c = 进位</span></span><br><span class="line">        a ^= b; <span class="comment">// a = 非进位和</span></span><br><span class="line">        b = c; <span class="comment">// 令b = 进位</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="字符串（十进制数）的加法运算"><a href="#字符串（十进制数）的加法运算" class="headerlink" title="字符串（十进制数）的加法运算"></a>字符串（十进制数）的加法运算</h2><p>两个十进制数用字符串表示，进行加法运算</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add</span> <span class="params">(string num1, string num2)</span> <span class="comment">// 低位在索引大的地方</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> num1.size() - <span class="number">1</span>, j = num2.size() - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span> || j &gt;= <span class="number">0</span> || carry)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> i &gt;= <span class="number">0</span> ? num1[i] : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> j &gt;= <span class="number">0</span> ? num2[j] : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> x + y + carry; </span><br><span class="line">        res += temp % <span class="number">10</span><span class="comment">// 非进位和</span></span><br><span class="line">            carry = temp / <span class="number">10</span>;</span><br><span class="line">        i--;</span><br><span class="line">        j--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    reverse(res); <span class="comment">// 反转为最终的结果</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="字符串（多进制数）加法运算"><a href="#字符串（多进制数）加法运算" class="headerlink" title="字符串（多进制数）加法运算"></a>字符串（多进制数）加法运算</h2><p>多进制数加法运算的基本思路：</p>
<p>设 a 和 b 是两个 k 进制数，对于第 i 位之和 ai+bi，先将 ai 和 bi 转化为十进制数，计算 ai+bi 的非进位和、进位，然后把非进位和转化为 k 进制数，继续计算下一位和。</p>
<p>与进制小于 10 的整数加法不同的地方在于，进制 &gt;10 的整数需要用字符串表示。</p>
<p>基于字符串（十进制数）的加法运算修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> <span class="title function_">getChar</span><span class="params">(<span class="type">int</span> n)</span> <span class="comment">// 将 0~35 （一位36进制数对应的十进制数）转化为36进制数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">9</span>)</span><br><span class="line">        <span class="keyword">return</span> n + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> n - <span class="number">10</span> + <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">getInt</span><span class="params">(<span class="type">char</span> ch)</span> <span class="comment">// 将一位36进制数转化为十进制数（0~35）</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;0&#x27;</span> &lt;= ch &amp;&amp; ch &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> ch - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> ch - <span class="string">&#x27;a&#x27;</span> + <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String <span class="title function_">add36Strings</span><span class="params">(string num1, string num2)</span> <span class="comment">// 低位在索引大的地方</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> num1.size() - <span class="number">1</span>, j = num2.size() - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span> || j &gt;= <span class="number">0</span> || carry)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> i &gt;= <span class="number">0</span> ? getInt(num1[i]) : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> j &gt;= <span class="number">0</span> ? getInt(num2[j]) : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> x + y + carry; </span><br><span class="line">        res += getChar(temp % <span class="number">36</span>); <span class="comment">// 非进位和 %36</span></span><br><span class="line">        carry = temp / <span class="number">36</span>; <span class="comment">// 进位 /36</span></span><br><span class="line">        i--;</span><br><span class="line">        j--;</span><br><span class="line">    &#125;</span><br><span class="line">    reverse(res); <span class="comment">// 反转</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h2><p>十进制数转换为多进制数</p>
<p>设 26 进制数</p>
<p>A -&gt; 1</p>
<p>B -&gt; 2</p>
<p>C -&gt; 3</p>
<p>…</p>
<p>Z -&gt; 26</p>
<p>AA -&gt; 27</p>
<p>AB -&gt; 28 </p>
<p>每次取10进制数的最低位：x%10 , x/=10。</p>
<p>将十进制数转换为26进制数。就是把10进制数当成26进制数，每次取26进制数的最低位。</p>
<p>StringBuffer sb = new StringBuffer();</p>
<p>​    while (x != 0) {</p>
<p>​      —x;</p>
<p>​      sb.append((char)(x % 26 + ‘A’));</p>
<p>​      x /= 26;</p>
<p>​    }</p>
<p>​    return sb.reverse().toString();</p>
<h1 id="乘法运算"><a href="#乘法运算" class="headerlink" title="乘法运算"></a>乘法运算</h1><p>讨论整数乘法。<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/multiply-strings/">43. 字符串相乘</a></p>
<h2 id="竖式乘法"><a href="#竖式乘法" class="headerlink" title="竖式乘法"></a>竖式乘法</h2><p>竖式运算思想，以 num1 为 123，num2 为 456 为例分析：</p>
<p><img src="/2022/04/24/basic-calculation/image-20220426105757303.png" alt></p>
<p>模拟：</p>
<p>法1：按行相加。求各行加数的时候，需要注意将加数乘10</p>
<p>法2：按列相加。</p>
<p>性质：num1[i] * num2[j] 的结果为 tmp（位数为两位，”0y”,”xy”的形式），令高位对应低索引。其第一位位于 res[i+j]，第二位 y 位于 res[i+j+1]。</p>
<p>由性质易知：设 num1 长度为M，num2 长度为N，则 res 长度至多为 M+N</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[num1.length() + num2.length()];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意两重循环顺序，保证res由十进制最低位（索引最大）到十进制最高位不断更新</span></span><br><span class="line"><span class="comment">// 否则，进位和无法正确处理</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> num1.length() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> num1.charAt(i) - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> num2.length() - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> num2.charAt(j) - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新res</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> res[i + j + <span class="number">1</span>] + n1 * n2;</span><br><span class="line">        res[i + j + <span class="number">1</span>] = sum % <span class="number">10</span>;</span><br><span class="line">        res[i + j] += sum / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="位运算实现乘法"><a href="#位运算实现乘法" class="headerlink" title="位运算实现乘法"></a>位运算实现乘法</h2><p>A*B，可以看成 A 个 B 相加。</p>
<p>先分析特定的一位，设 B 的第 i 位为 1，A 个 B 相加，那么这一位对最后结果的贡献就是：A&lt;&lt;i</p>
<p>实际上就是说：第 0 位加 A 个 1=A，第 i 位加 A 个 1=A&lt;&lt;i。</p>
<p>推广到所有二进制位，A*B 求法如下。遍历 B 的二进制位，当遍历到 B 的低 i 位时，加数应该是 A &lt;&lt;i </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">quickMulti</span><span class="params">(<span class="type">int</span> A, <span class="type">int</span> B)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;B;B &gt;&gt;= <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(B &amp; <span class="number">1</span>)</span><br><span class="line">            ans += A;</span><br><span class="line">        A &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意该算法的风险在于 A&lt;&lt;i 太大的话，存储位数不够，可能溢出。</p>
<p>实际上，该过程等价于将十进制数表示为二进制数，并列出竖式乘法式子：5<em>3 = 101 </em> 011 =</p>
<p><img src="/2022/04/24/basic-calculation/image-20220426110101126.png" alt></p>
<p>例题：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/qiu-12n-lcof/">剑指 Offer 64. 求1+2+…+n</a></p>
<ul>
<li><p>法1：根据等差数列求和，1+…+n = n*(n+1)/2，式中的乘法可以用位运算实现，/2 也可以用右移一位实现</p>
<p>  警惕在位运算符前后使用其他符号，位运算式子经常需要括号括起来。</p>
</li>
<li><p>法2：记sum(n) = 1+…+n，sum(n) = n + sum(n-1)，递归。可以避免循环体</p>
</li>
</ul>
<h1 id="除法运算"><a href="#除法运算" class="headerlink" title="除法运算"></a>除法运算</h1><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/divide-two-integers/">29. 两数相除</a></p>
<p>法1</p>
<p>二分查找除法运算结果。</p>
<p>设除法运算式为：A/B = x</p>
<p>则一定满足x*B &gt;= A</p>
<p>对于二分查找的每一个 x，需要计算x*B，可以使用位运算计算乘法。可以不完整算出x*B的结果，只要在计算过程中发现tmpres &gt;= A就可返回。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">x</span> <span class="operator">=</span> a, y = b;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isNeg</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> ((x &gt; <span class="number">0</span> &amp;&amp; y &lt; <span class="number">0</span>) || (x &lt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span>)) isNeg = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x;</span><br><span class="line">        <span class="keyword">if</span> (y &lt; <span class="number">0</span>) y = -y;</span><br><span class="line">        <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = x;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">mid</span> <span class="operator">=</span> l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (mul(mid, y) &lt;= x) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> isNeg ? -l : l;</span><br><span class="line">        <span class="keyword">if</span> (ans &gt; Integer.MAX_VALUE || ans &lt; Integer.MIN_VALUE) <span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 位运算实现乘法</span></span><br><span class="line">    <span class="type">long</span> <span class="title function_">mul</span><span class="params">(<span class="type">long</span> a, <span class="type">long</span> k)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((k &amp; <span class="number">1</span>) == <span class="number">1</span>) ans += a;</span><br><span class="line">            k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            a += a;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>法2</p>
<p>设A/B = x…y，即A = x*B + y</p>
<p>逼近</p>
<p>基本思想：A每次减去一个B，直到减不动，记录减法的次数</p>
<p>优化：每次尽量减去B的倍数中最大的</p>
<p>2 按照二进制位逼近。首先，除法的结果 x 必定能表示成一个二进制数，也就是说，我们只要找一个二进制数x，令x*B 是小于等于 y 的最大数。而根据之前所述位运算与乘法的关系，如果 x 的第 i 位为1，那么这一位对x*B的贡献就是：B&lt;&lt;i。因此，我们可以做减法来找x。</p>
<p>只需要找二进制1</p>
<p>先找x的最高位1，让B从左移到可能的最高位到左移0位尝试，第一个B&lt;&lt;i小于等于y则找到第i位为1，然后令A-=x，重复上述操作。</p>
<p>上述操作默认都是正数，分析的是对正数原码/补码的操作。</p>
<p>如果存在负数，可以仍旧算正数除法，即先判断相除后的负号，对绝对值求除法</p>
<p>问题1：需要注意−2^31^，相反数是本身。需要特别列出−2^31^作为被除数或除数的结果。</p>
<p>排除了−2^31^参与计算的情况后，被除数和除数的取值范围变成[-(2^31^ – 1), 2^31^ − 1]，运算数能够被int存储，并且，此时除法运算的最小值=-(2^31^ – 1)，最大值=2^31^ – 1，也在存储范围[−2^31^, 2^31^ − 1]内，能够被int存储。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> dividend, <span class="type">int</span> divisor)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(dividend == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(divisor == <span class="number">1</span>) <span class="keyword">return</span> dividend;</span><br><span class="line">        <span class="keyword">if</span>(divisor == -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dividend&gt;INT_MIN) <span class="keyword">return</span> -dividend;<span class="comment">// 只要不是最小的那个整数，都是直接返回相反数就好啦</span></span><br><span class="line">            <span class="keyword">return</span> INT_MAX;<span class="comment">// 是最小的那个，那就返回最大的整数啦</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">a</span> <span class="operator">=</span> dividend;</span><br><span class="line">        <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> divisor;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sign</span> <span class="operator">=</span> <span class="number">1</span>; </span><br><span class="line">        <span class="keyword">if</span>((a &gt; <span class="number">0</span> &amp;&amp; b &lt; <span class="number">0</span>) || (a &lt; <span class="number">0</span> &amp;&amp; b &gt; <span class="number">0</span>))&#123;</span><br><span class="line">            sign = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        a = a&gt;<span class="number">0</span>?a:-a; <span class="comment">// 求正数除法</span></span><br><span class="line">        b = b&gt;<span class="number">0</span>?b:-b;</span><br><span class="line">        <span class="type">long</span> <span class="variable">res</span> <span class="operator">=</span> div(a,b);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(sign&gt;<span class="number">0</span>)<span class="keyword">return</span> res&gt;INT_MAX?INT_MAX:res;</span><br><span class="line">        <span class="keyword">return</span> -res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">long</span> a, <span class="type">long</span> b)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(a &lt; b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">tb</span> <span class="operator">=</span> b; </span><br><span class="line">        <span class="comment">// 找到当前能减的最大值</span></span><br><span class="line">        <span class="keyword">while</span>((tb+tb)&lt;=a)&#123;</span><br><span class="line">            count &lt;&lt;= <span class="number">1</span>; </span><br><span class="line">            tb &lt;&lt;= <span class="number">1</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count + div(a-tb,b); <span class="comment">// 递归调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="幂运算"><a href="#幂运算" class="headerlink" title="幂运算"></a>幂运算</h1><h2 id="整数次幂"><a href="#整数次幂" class="headerlink" title="整数次幂"></a>整数次幂</h2><h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><p>当我们要计算 x^n（n为整数）时，我们可以先计算出 y = x^⌊n/2⌋，其中 ⌊n/2⌋ 表示进行下取整；</p>
<p>如果 n 为偶数，那么 x^n = y^2 </p>
<p>如果 n 为奇数，那么 x^n = y^2*x；（如果n是负数，那么/x）</p>
<p>边界条件 n = 0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">myPow</span><span class="params">(<span class="type">double</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> <span class="variable">y</span> <span class="operator">=</span> myPow(x, n/<span class="number">2</span>); <span class="comment">// 存储为y，避免重复计算y</span></span><br><span class="line">    <span class="type">double</span> <span class="variable">yy</span> <span class="operator">=</span> y*y;</span><br><span class="line">    <span class="keyword">if</span>(n % <span class="number">2</span> == <span class="number">0</span>) </span><br><span class="line">        <span class="keyword">return</span> yy;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">0</span>) <span class="keyword">return</span> yy/x;</span><br><span class="line">        <span class="keyword">return</span> yy*x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h3><p><strong>快速幂</strong></p>
<p>例如，求x^77^</p>
<p>利用幂运算的性质：x^a^ * x^b^ = x^a+b^，因此，只需要找到一组数，令它们之和为77。</p>
<p>将 77 写作二进制表示， (1001101)，容易知道 77= 1 + 100 + 1000 + 1000000，写成十进制即：77=1+4+8+64</p>
<p>注意这种算法<strong>要求 n 为正数（负数的二进制表示是补码），若n为负数需要先转化为正数</strong></p>
<p>因此，我们递推 x^1^，x^2^，x^4^，x^8^，x^16^，x^32^，x^64^，对于有用的幂次方 1、4、8、64 拿来 计算。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">quickMul</span><span class="params">(<span class="type">double</span> x, <span class="type">long</span> N)</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 贡献的初始值为 x</span></span><br><span class="line">    <span class="type">double</span> <span class="variable">x_contribute</span> <span class="operator">=</span> x;</span><br><span class="line">    <span class="keyword">while</span> (N &gt; <span class="number">0</span>) &#123; <span class="comment">// 遍历二进制位，递推x_contribute ，x^1, x^2, x^4,…,x^64</span></span><br><span class="line">        <span class="keyword">if</span> (N % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            ans *= x_contribute;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 递推</span></span><br><span class="line">        x_contribute *= x_contribute;</span><br><span class="line"></span><br><span class="line">        N &gt;&gt;= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="幂不为整数"><a href="#幂不为整数" class="headerlink" title="幂不为整数"></a>幂不为整数</h2><p>当n不为整数，例如当n=1/2，即计算根号x时：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sqrtx/">69. x 的平方根 </a></p>
<p>二分查找结果，需要注意溢出问题，即判断a*a与x的大小关系时，a*a有可能溢出</p>
<p>牛顿迭代法（基于二阶泰勒）</p>
<h1 id="异或运算"><a href="#异或运算" class="headerlink" title="异或运算"></a>异或运算</h1><p><img src="/2022/04/24/basic-calculation/image-20220426111659514.png" alt></p>
<p>性质5推广：</p>
<p>设函数</p>
<script type="math/tex; mode=display">
sumXOR(x)=0⊕1⊕⋯⊕x</script><p>——根据性质5，易知：对于任意整数 i，以 4i 为开头的连续四个整数异或的结果为 0，因此，将 0~x 按每四个数为一组分别求异或进行化简得：</p>
<p><img src="/2022/04/24/basic-calculation/image-20220426111752200.png" alt></p>
<p>利用异或运算性质易知：任意连续整数序列的异或和</p>
<script type="math/tex; mode=display">
a⊕(a+1)⊕⋯⊕(a+n)=sumXOR(a+n)⊕sumXOR(a-1)</script><p>例题：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/xor-operation-in-an-array/">1486. 数组异或操作</a></p>
<p>给你两个整数，n 和 start 。</p>
<p>数组 nums 定义为：nums[i] = start + 2*i（下标从 0 开始）且 n == nums.length 。</p>
<p>请返回 nums 中所有元素按位异或（XOR）后得到的结果。</p>
<p>求：</p>
<script type="math/tex; mode=display">
ans=start⊕(start+2)⊕…⊕(start+2(n-1))</script><p>考虑用性质 5 推论求解。需要将式中的运算数化为连续整数。</p>
<p>为此，我们尝试将每个运算数除以 2（向下取整），得：</p>
<script type="math/tex; mode=display">
ans=2×[s⊕(s+1)⊕…⊕(s+(n-1))]+e</script><p>式中，$s=\lfloor start/2 \rfloor$，e 表示 ans 的最低位。向下取整是因为我们实际上做的是对每个运算数右移一位的操作。乘 2 实际上是左移操作。</p>
<p>如下证明该式的正确性：</p>
<p>1 根据移位运算性质有：</p>
<script type="math/tex; mode=display">
(a+b)≫1=(a≫1)+(b≫1)</script><p>2 证</p>
<script type="math/tex; mode=display">
a⊕b=2×[(a≫1)⊕(b≫1)]+e</script><p><img src="/2022/04/24/basic-calculation/image-20220426112044386.png" alt></p>
<p>于是，</p>
<script type="math/tex; mode=display">
\begin{align*}
ans&=sumXOR(s+n-1)⊕sumXOR(s-1)\\ 
e &=n\&start\&1

\end{align*}</script><h2 id="只出现一次的数字"><a href="#只出现一次的数字" class="headerlink" title="只出现一次的数字"></a>只出现一次的数字</h2><p><strong>基本问题</strong></p>
<p>如果除了一个数字以外，其他数字都出现了两次，那么如何找到出现一次的数字？</p>
<p>全员进行异或操作，结果就是那个出现了一次的数字。也可以用扩展内容的方法。</p>
<p><strong>拓展</strong></p>
<p>在一个数组 nums 中除一个数字只出现一次之外，其他数字都出现了三次。请找出那个只出现一次的数字。</p>
<p>观察所有数的某一比特位。对于只出现了一次的数字的第 i 个二进制位，它可能为 0 或 1。对于数组中其他的元素，每一个元素都出现了 3 次，对应着第 i 个二进制位的 3 个 0 或 3 个 1，无论是哪一种情况，它们的和（十进制和）都是 3 的倍数（即和为 0 或 3）。</p>
<p>因此，<strong>数组中所有元素的第 i 个二进制位之和（十进制求和）除以 3 的余数等于只出现一次的数字的第i位</strong></p>
<p>这样一来，对于数组中的每一个元素 x，我们使用位运算(x &gt;&gt; i) &amp; 1 得到 x 的第 i 个二进制位，并将它们相加再对 3 取余，得到的结果一定为 0 或 1，即为答案的第 i 个二进制位。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] counts = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">32</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">32</span>; j++) &#123;</span><br><span class="line">                counts[j] += num &amp; <span class="number">1</span>;</span><br><span class="line">                num &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>, m = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">            res &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            res |= counts[<span class="number">31</span> - i] % m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上，通用解法不需要每次求状态转移方程和输出方程，容易直接推广到：</p>
<p>在一个数组 nums 中除一个数字只出现一次之外，其他数字都出现了 m 次</p>
<p>上述方法中，我们是依次处理32个比特位的。对于每个二进制位的运算结果（即求和再对 3 取余），实际上满足以下关系：</p>
<p><img src="/2022/04/24/basic-calculation/image-20220426112431394.png" alt></p>
<p>这其实是一个状态机的图。为了用一个关系式描述来描述这个状态机，依据数电的知识，首先需要用两个二进制位来表示 3 个状态，状态机的变量就是两个二进制位。</p>
<p><img src="/2022/04/24/basic-calculation/image-20220426112457632.png" alt></p>
<p>接下来，需要通过 <strong>状态转移表</strong> 导出 <strong>状态转移的公式</strong> </p>
<p><img src="/2022/04/24/basic-calculation/image-20220426112510102.png" alt></p>
<p>根据此表中新的ai为1的行，可得新的ai的求法：</p>
<script type="math/tex; mode=display">
a_{i}^{'}=\bar{a_{i}}b_{i}x_{i}+a_{i}\bar{b_{i}}x_{i}</script><p>同理得新的bi的求法：</p>
<script type="math/tex; mode=display">
b_{i}^{'}=\bar{a_{i}}\bar{b_{i}}x_{i}+\bar{a_{i}}b_{i}\bar{x_{i}}=\bar{a_{i}}(b_{i}⊕x_{i})</script><p>通常我们还需要画出输出状态表，便于得到每次状态转移后对应的输出，但由于此题只需要最终的输出值，因此不需要记录输出变量。</p>
<p>当我们遍历完数组中的所有元素后，aibi要么是 00，表示答案的第 i 位是 0；要么是 01，表示答案的第 i 位是 1。注意，不存在状态机中的10状态，该状态只在未遍历完成时有可能出现。因此我们只需要返回 b 作为答案即可。</p>
<p>由于每个二进制位满足如上两个关系式，因此我们可以把两个二进制位的位运算推广到两个整数的位运算，即设整数a、b，遍历数组中任意一个整数，代入上述两个位运算公式改变a、b。</p>
<h2 id="两个只出现一次的数字"><a href="#两个只出现一次的数字" class="headerlink" title="两个只出现一次的数字"></a>两个只出现一次的数字</h2><p>如果除了两个数字以外，其他数字都出现了两次，那么如何找到两个只出现一次的数字？<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/single-number-iii/">260. 只出现一次的数字 III</a></p>
<p>如果我们可以把所有数字分成两组，使得：</p>
<p>两个只出现一次的数字在不同的组中；</p>
<p>相同的数字会被分到相同的组中。</p>
<p>相当于分解成了基础问题：一个数组中只出现一次的数字。那么对两个组分别进行异或操作，即可得到答案的两个数字。</p>
<p>如何实现这样的分组呢？</p>
<p>结论1：若数组中每个数字都出现了两次，任选一个二进制位<em>i</em>，将该位为1的分为一组，该位为0的分为一组，可以保证每组中仍满足每个数字都出现了两次，即相同元素（任意二进制位相同）必被分为同组</p>
<p>记这两个只出现了一次的数字为 <em>a</em> 和 <em>b</em>，设 <em>a</em> 和 <em>b</em> 异或结果为<em>x</em>，设<em>xi</em>表示<em>x</em>二进制第<em>i</em>位，<em>ai</em>表示<em>a</em>二进制第<em>i</em>位，<em>bi</em>表示<em>b</em>二进制第<em>i</em>位.</p>
<p>因为a≠b，所以a和b一定存在不同的二进制位。设<em>xi</em>=1，即<em>ai</em> ≠ <em>bi</em>，因此根据第<em>i</em>位，能将<em>a</em>和<em>b</em>分开。</p>
<p>结合结论1，有：</p>
<p>结论2：将数组看作<em>a</em>、<em>b</em>、其他数字的集合（每个数字都出现了两次），按照第<em>i</em>位分成两组，可以保证每组只含<em>a</em>或<em>b</em>，组中剩余数字（每个数字都出现了两次）</p>
<p>实际操作：先对所有数字异或得到数字<em>x</em>=<em>a</em>^<em>b</em>。然后任取满足<em>xi</em>=1的位<em>i</em>（由于a≠b，因此该位必定存在），分为两组。在每个组内进行异或操作，得到两个数字。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] singleNumber(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">xorsum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : nums) &#123;</span><br><span class="line">        xorsum ^= x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">div</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ((div &amp; xorsum) == <span class="number">0</span>) &#123; <span class="comment">// 找到所有元素异或和为1的位置i，该位置用1&lt;&lt;i表示，而不用第i位表示</span></span><br><span class="line">        div &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : nums) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((div &amp; x) != <span class="number">0</span>) &#123; <span class="comment">// 分组，该位为0的分到一组</span></span><br><span class="line">            a ^= x;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            b ^= x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;a, b&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/24/math-related-problems/" rel="prev" title="数学相关的算法题">
      <i class="fa fa-chevron-left"></i> 数学相关的算法题
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/25/DSU/" rel="next" title="并查集 DSU">
      并查集 DSU <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B1%82%E4%BD%99%E8%BF%90%E7%AE%97%E5%92%8C%E6%B1%82%E6%A8%A1%E8%BF%90%E7%AE%97"><span class="nav-number">1.</span> <span class="nav-text">求余运算和求模运算</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E6%95%B0%E5%8F%96%E4%BD%99"><span class="nav-number">1.1.</span> <span class="nav-text">大数取余</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A0%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">2.</span> <span class="nav-text">加法运算</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E5%AE%9E%E7%8E%B0%E5%8A%A0%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">2.1.</span> <span class="nav-text">位运算实现加法运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88%E5%8D%81%E8%BF%9B%E5%88%B6%E6%95%B0%EF%BC%89%E7%9A%84%E5%8A%A0%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">2.2.</span> <span class="nav-text">字符串（十进制数）的加法运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88%E5%A4%9A%E8%BF%9B%E5%88%B6%E6%95%B0%EF%BC%89%E5%8A%A0%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">2.3.</span> <span class="nav-text">字符串（多进制数）加法运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2"><span class="nav-number">2.4.</span> <span class="nav-text">进制转换</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%98%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">3.</span> <span class="nav-text">乘法运算</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AB%96%E5%BC%8F%E4%B9%98%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">竖式乘法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E5%AE%9E%E7%8E%B0%E4%B9%98%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">位运算实现乘法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%A4%E6%B3%95%E8%BF%90%E7%AE%97"><span class="nav-number">4.</span> <span class="nav-text">除法运算</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%82%E8%BF%90%E7%AE%97"><span class="nav-number">5.</span> <span class="nav-text">幂运算</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E6%95%B0%E6%AC%A1%E5%B9%82"><span class="nav-number">5.1.</span> <span class="nav-text">整数次幂</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%92%E5%BD%92"><span class="nav-number">5.1.1.</span> <span class="nav-text">递归</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%B9%82"><span class="nav-number">5.1.2.</span> <span class="nav-text">快速幂</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%82%E4%B8%8D%E4%B8%BA%E6%95%B4%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">幂不为整数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97"><span class="nav-number">6.</span> <span class="nav-text">异或运算</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97"><span class="nav-number">6.1.</span> <span class="nav-text">只出现一次的数字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A4%E4%B8%AA%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97"><span class="nav-number">6.2.</span> <span class="nav-text">两个只出现一次的数字</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Cyl"
      src="/images/icon1.jpg">
  <p class="site-author-name" itemprop="name">Cyl</p>
  <div class="site-description" itemprop="description">顽童大了别那么笨</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyl</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'bj1pUPUVv7CB9DzNJpPiyH5u-gzGzoHsz',
      appKey     : 'RQWkhgEzgN0MjSY1E3rSiuJc',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '9' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
